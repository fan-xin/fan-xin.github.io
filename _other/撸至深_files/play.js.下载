var videoId,statsVideoId,timeoutId,downloadLayer,isShowDownload=!1;window.onbeforeunload=statsPlayTime,window.onunload=statsPlayTime;var statsId,removeWidthLimit=function(){"*{max-width: 600px !important;}"==$("style:last").html()&&$("style:last").remove()},addWidthLimit=function(){isPc()};function getVideoInfo(){ajaxHelper.get(getUrl("search/getById"),{id:Util.getQueryString("id")},function(e){if(e.success){var t=e.obj;if(null==t)return $("#fixedVideo").html("<div class='nodata-tip'>视频已下架</div>"),!1;statsVideoId=e.obj.videoId,$("#videoDesc").html(renderVideoInfo(t)),$("#more_info_list").html(renderRelatedVideoList(t.relatedVideo)),$("#videoCover").attr("poster",imageServer+t.cover),$("#videoPath").attr("src",videoServer+t.path),zymedia("video",{mediaTitle:t.title,preload:"auto",enterFullScreenEvent:removeWidthLimit,exitFullScreenEvent:addWidthLimit})}},!0,!1)}function renderVideoInfo(e){var t=new Date(1e3*e.uploadTime).Format("yyyy-MM-dd"),i=parseInt(e.duration/60)+"分"+e.duration%60+"秒";return videoId=e.id,'    <div class="videoTitle">\n      '+e.title+'\n\n    </div>\n    <div class="videoDetail">\n      <div class="videoDetailItemList">\n        <div class="videoDetailItem"><span>片长：'+i+'</span></div>\n        <div class="videoDetailItem"><span>更新日期：'+t+'</span></div>\n      </div>      <div class="videoDetailItem2"><span>'+e.summary+"</span></div>\n    </div>"}function renderRelatedVideoList(e){if(0==e.length)return"<div class='nodata-tip'>暂无视频数据</div>";var t="";for(var i in e){var a=e[i],o=new Date(1e3*a.uploadTime).Format("yyyy-MM-dd"),n=parseInt(a.duration/60)+"分"+a.duration%60+"秒";t+='    <li class="liInfo" onclick="location.href = \'/play.html?id='+a.id+'\'">\n      <img src="'+imageServer+a.cover+'" class="itemImg" alt="">\n      <p class="itemTitle">'+a.title+'</p>\n      <div class="timeInfo">\n        <div class="date">\n          '+o+'\n        </div>\n        <div class="time">\n          '+n+"\n        </div>\n      </div>\n    </li>"}return t}function showAddFavorite(){var e=(new Date).Format("yyyy-MM-dd"),t=sessionStorage.getItem("bakDomain"),i=localStorage.getItem("counter"+e);3==i&&null!=t&&layer.open({type:1,area:"8rem",title:"请收藏本站备用地址~",shade:.6,anim:0,resize:!1,shadeClose:!0,content:"<div style='margin-left: 0.2rem;'>备用域名：</div><div style='text-align: center;font-size: 0.7rem; word-break: break-all;\n    color: #00aff0;'>"+t+"</div><div style='margin-left: 3rem;margin-top:0.4rem'>请保存到收藏夹，以防忘记～</div>"}),i=parseInt(i)+1,localStorage.setItem("counter"+e,i)}function getPlayAd(){if(!isShowAd())return!1;var e=parseInt(localStorage.getItem("adPositonPlayExpire"));if(Util.currentTimestamp()<e){var t=localStorage.getItem("adPositonPlayData");renderPlayAd(jQuery.parseJSON(t))}else{var i={position:adPositonPlayId};ajaxHelper.get(getUrl("getAdvertList"),i,function(e){if(e.success&&0<e.obj.length){renderPlayAd(e.obj);var t=e.obj[0].endTime;Util.currentTimestamp()+600<t&&(t=Util.currentTimestamp()+600),localStorage.setItem("adPositonPlayExpire",t),localStorage.setItem("adPositonPlayData",JSON.stringify(e.obj))}else console.log(e.msg)})}}function renderPlayAd(e){var t='<div class="swiper-slide">\n              <a style=\'cursor: pointer\'>                  <img src="'+imageServer+e[0].pic+'"  alt="'+e[0].title+'" onclick="openAd(\''+e[0].link+"',"+e[0].id+')">\n               </a>           </div>';$("#play_advert").html(t),Util.sendStats(2,e[0].id,0,"play.html")}function backToIndex(){statsPlayTime(),history.go(-1)}function showDownloadTips(){isShowDownload=!0,downloadLayer=layer.open({type:1,area:"8rem",title:"建议下载本站APP",shade:.6,anim:0,resize:!1,shadeClose:!0,content:"<div style='margin-left: 0.2rem;'>你的加载有点慢哦~</div><div style='margin-left: 0.2rem;'>建议下载本站APP获得更爽的播放体验：</div><div style='text-align: center;font-size: 0.45rem;height: 1rem;padding-top: 0.2rem;'>    <a href='"+downloadUrl+"' target='_blank'>"+downloadUrl+"</a></div><div style='margin-left: 3rem;margin-top:0.1rem; height: 1rem;'>    <button style='width: 2rem;height: 0.8rem;' onclick='openDownload()'>立即下载</button></div>"})}function openDownload(){var e=window.navigator.userAgent.toLowerCase(),t=navigator.userAgent;"micromessenger"==e.match(/MicroMessenger/i)?window.location.href=downloadUrl:-1<t.indexOf("Android")||-1<t.indexOf("Linux")?window.location.href=apkUri:-1<t.indexOf("iPhone")?window.location.href=iosUri:window.location.href=downloadUrl}function statsPlayTime(){var e=localStorage.getItem("playTimestamp");if(null!=e){var t=Util.currentTimestamp()-parseInt(e);Util.sendStats(5,statsVideoId,t,"play.html"),localStorage.removeItem("playTimestamp")}}$(function(){getVideoInfo(),showAddFavorite(),getPlayAd(),localStorage.removeItem("playTimestamp"),$("#videoCover").bind("contextmenu",function(){return!1})});var isStatsed=!1,isPlaying=!1;function doCanplay(){clearTimeout(timeoutId),layer.close(downloadLayer)}function doWaiting(){clearTimeout(statsId),statsId=void 0,isShowDownload||(timeoutId=setTimeout(function(){showDownloadTips()},2e4))}function doPlay(){if(isPlaying=!0,null==localStorage.getItem("playTimestamp")){var e=Util.currentTimestamp();localStorage.setItem("playTimestamp",e)}}function doProgress(){!isPlaying||statsId||isStatsed||(statsId=setTimeout(function(){sendStats()},15e3))}function doPause(){isPlaying=!1,clearTimeout(statsId),statsId=void 0}function sendStats(){Util.sendStats(4,statsVideoId,0,"play.html"),isStatsed=!0}